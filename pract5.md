# Практическое занятие №4. Вопрос виртуализации

Ерченков А. А. - ИКБО-62-23

## Задание 1
```
LOAD_FAST 0 (x)     # Загрузка значения локальной перменной x (индекс 0) в стек
LOAD_CONST 1 (10)   # Загрузка константы 10
BINARY_MULTIPLY ()  # Умножение двух значений (x и 10) из стека
LOAD_CONST 2 (42)   # Загрузка константы 42
BINARY_ADD          # Сложение двух значений (рез. умножения и 42)
RETURN_VALUE        # Возврат верхнего значения из стека
```

Эквивалентный код на Python:
```python
def foo(x):
    return (x * 10) + 42
```

## Задание 2
Этот байткод представляет собой функцию, вычисляющую **факториал числа**.

```
 0 LOAD_CONST 1 (1)        # Загрузка константы в стек
 2 STORE_FAST 1 (r)        # Сохранение значения 1 в локальной переменной r (индекс 1)

 4 LOAD_FAST 0 (n)         # Загрущка значения локально переменной n (индекс 0) в стек
 6 LOAD_CONST 1 (1)        # Загрузка константы 1 в стек
 8 COMPARE_OP 4 (>)        # Сравнение значения n (из стека) с 1 (из стека)
10 POP_JUMP_IF_FALSE 30    # Если результат n > 1 ложный, то переход к инструкции на метке 30

12 LOAD_FAST 1 (r)         # Загрузка значение переменной r в стек
14 LOAD_FAST 0 (n)         # Загрузка текущего значения n в стек
16 INPLACE_MULTIPLY        # Умножение с присваиванием (r *= n)
18 STORE_FAST 1 (r)        # Сохранение обновленного значения r в r

20 LOAD_FAST 0 (n)         # Загрузка значения переменной n
22 LOAD_CONST 1 (1)        # Загрузка константы 1
24 INPLACE_SUBTRACT        # Вычитание с присваиванием (n -= 1)
26 STORE_FAST 0 (n)        # Сохранение обновленного значения n
28 JUMP_ABSOLUTE 4         # Переход к инструкции на метке 4 (-> n > 1)

30 LOAD_FAST 1 (r)         # Загрузка значения переменной r (результат вычисления факториала)
32 RETURN_VALUE            # Возврат значения переменной r (факториал числа n)
```

## Задание 3
JVM-байткод 

- 1
```java
public class Sample {
    public static int foo(int x) {
        return (x * 10) + 42;
    }
}
```

```
iload_0     # Загрузка значение переменной x
bipush 10   # Загрузка константы 10 в стек
imul        # Операция умножения
bipush 42   # Загрузка константы 42 в стек
iadd        # Сложение результата умножения и константы 42
ireturn     # Возврат результата
```

- 2
```java
public class Sample {
    public static int factorial(int n) {
        int r = 1;
        while (n > 1) {
            r *= n;
            n -= 1;
        }
        return r;
    }
}
```

```
iconst_1    # Загрузка 1 в стек
istore_1    # Сохранение значения 1 в переменную r
iload_0     # Загрузка значение переменной n в стек
iconst_1    # Загрузка 1 в стек
if_icmle    # Проверка меньше ли или равно n единице. Если да, перейти к завершению
iload_1     # Загрузка значения r в стек
iload_0     # Загрузка значения n в стек
imul        # Умножение значений r и n, результат помещается обратно в r
istore_1    # Сохранение обновленного значения r
iload_0     # Загрузка значения n
iconst_1    # Загрузка 1 в стек
isub        # Вычитание 1 из n, результат помещается обратно в n
istore_0    # Сохранение обновленного значения n
goto        # Возвращение к проверке условия цикла
iload_1     # Загрузка результата в r
ireturn     # Возврат результата
```

## Задание 4